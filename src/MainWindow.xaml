<Window x:Class="EasyMICBooster.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:loc="clr-namespace:EasyMICBooster.Localization"
        xmlns:tb="http://www.hardcodet.net/taskbar"
        Title="{loc:Tr App_Title}" 
        Height="auto" Width="520"
        SizeToContent="Height"
        WindowStartupLocation="CenterScreen"
        Background="{StaticResource BackgroundBrush}"
        ResizeMode="CanResize"
        Icon="/Resources/App.ico"
        WindowStyle="SingleBorderWindow">
    
    <Window.Effect>
        <DropShadowEffect BlurRadius="20" ShadowDepth="0" Opacity="0.3"/>
    </Window.Effect>
    
    <Grid Margin="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="0,0,0,24">
            <Grid>
                 <StackPanel Orientation="Horizontal" HorizontalAlignment="Left">
                     <Image Source="/Resources/App.ico" Width="32" Height="32" Margin="0,0,12,0" RenderOptions.BitmapScalingMode="HighQuality"/>
                     <TextBlock Text="Easy MIC Booster" 
                           FontSize="28" FontWeight="Bold" 
                           Foreground="{StaticResource TextPrimaryBrush}" VerticalAlignment="Center"/>
                 </StackPanel>
                 
                 <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Top">
                     <!-- Language Selector -->
                     <ComboBox x:Name="LanguageCombo" Width="80" SelectionChanged="Language_SelectionChanged">
                         <ComboBoxItem Content="æ—¥æœ¬èªž" Tag="ja" IsSelected="True"/>
                         <ComboBoxItem Content="English" Tag="en"/>
                     </ComboBox>
                 </StackPanel>
            </Grid>


        </StackPanel>
        


        <!-- Device Selection -->
        <!-- Device Selection -->
        <Border Grid.Row="1" Background="{StaticResource SurfaceBrush}" 
                CornerRadius="12" Padding="16" Margin="0,0,0,16">
             <!-- (Content Unchanged) -->
             <StackPanel>
                <TextBlock Text="{loc:Tr Group_Device}" FontSize="14" FontWeight="SemiBold" Foreground="{StaticResource TextSecondaryBrush}" Margin="0,0,0,12"/>
                <TextBlock Text="{loc:Tr Label_Input}" FontSize="12" Foreground="{StaticResource TextSecondaryBrush}" Margin="0,0,0,4"/>
                <Border x:Name="InputDeviceBorder" BorderBrush="#555555" BorderThickness="1" CornerRadius="3" Margin="0,0,0,12">
                    <ComboBox x:Name="InputDeviceCombo" Height="30" DisplayMemberPath="FriendlyName" SelectionChanged="Device_SelectionChanged" BorderThickness="0"/>
                </Border>
                <TextBlock Text="{loc:Tr Label_Output}" FontSize="12" Foreground="{StaticResource TextSecondaryBrush}" Margin="0,0,0,4"/>
                <Border x:Name="OutputDeviceBorder" BorderBrush="#555555" BorderThickness="1" CornerRadius="3">
                    <ComboBox x:Name="OutputDeviceCombo" Height="30" DisplayMemberPath="FriendlyName" SelectionChanged="Device_SelectionChanged" BorderThickness="0"/>
                </Border>
                <Button Content="{loc:Tr Btn_Refresh}" Click="RefreshDevices_Click" Margin="0,12,0,0" Height="30" FontSize="12" Padding="10,0"/>
            </StackPanel>
        </Border>
        
        <!-- Gain Slider Removed -->

        <!-- Visual EQ -->
        <!-- Visual EQ -->
        <!-- Visual EQ -->
        <Border Grid.Row="2" Background="{StaticResource SurfaceBrush}" 
                CornerRadius="12" Padding="16" Margin="0,0,0,16">
            <StackPanel>
                 <Grid Margin="0,0,0,12">
                     <Grid.ColumnDefinitions>
                         <ColumnDefinition Width="*"/>
                         <ColumnDefinition Width="Auto"/>
                     </Grid.ColumnDefinitions>
                     <TextBlock Grid.Column="0" Text="{loc:Tr Group_Eq}" FontSize="14" FontWeight="SemiBold" Foreground="{StaticResource TextSecondaryBrush}" VerticalAlignment="Center"/>
                     <!-- Boost Toggle -->
                     <ToggleButton x:Name="BoostToggle" Grid.Column="1"
                                   IsChecked="True"
                                   Width="120" Height="28"
                                   Checked="BoostToggle_Changed" Unchecked="BoostToggle_Changed"
                                   FontWeight="Bold">
                         <ToggleButton.Template>
                             <ControlTemplate TargetType="ToggleButton">
                                 <Border x:Name="border" CornerRadius="4" Background="{StaticResource SurfaceBrush}" BorderBrush="#555" BorderThickness="1">
                                     <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center">
                                         <Ellipse x:Name="indicator" Width="10" Height="10" Margin="0,0,8,0" Fill="#FF4444"/>
                                         <TextBlock x:Name="text" Text="{loc:Tr Btn_ToggleBoost_Off}" Foreground="{StaticResource TextPrimaryBrush}" FontSize="12"/>
                                     </StackPanel>
                                 </Border>
                                 <ControlTemplate.Triggers>
                                     <Trigger Property="IsChecked" Value="True">
                                         <Setter TargetName="border" Property="Background" Value="#101010"/>
                                         <Setter TargetName="border" Property="BorderBrush" Value="{StaticResource AccentBrush}"/>
                                         <Setter TargetName="indicator" Property="Fill" Value="#00FF00"/>
                                         <Setter TargetName="text" Property="Text" Value="{loc:Tr Btn_ToggleBoost_On}"/>
                                         <Setter TargetName="text" Property="Foreground" Value="White"/>
                                     </Trigger>
                                     <Trigger Property="IsMouseOver" Value="True">
                                         <Setter TargetName="border" Property="Background" Value="#444"/>
                                     </Trigger>
                                 </ControlTemplate.Triggers>
                             </ControlTemplate>
                         </ToggleButton.Template>
                     </ToggleButton>
                 </Grid>
                
                <!-- EQ Header Controls -->
                <Grid Margin="0,0,0,12">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <CheckBox x:Name="FlatModeCheck" Grid.Column="0" Content="{loc:Tr Check_FlatMode}" IsChecked="False" Checked="FlatMode_Changed" Unchecked="FlatMode_Changed" VerticalAlignment="Center" FontWeight="SemiBold" Foreground="{StaticResource TextSecondaryBrush}"/>
                    <CheckBox x:Name="UnlockLimitCheck" Grid.Column="1" Content="{loc:Tr Check_UnlockLimit}" IsChecked="False" Checked="UnlockLimit_Changed" Unchecked="UnlockLimit_Changed" Margin="16,0,0,0" VerticalAlignment="Center" FontWeight="SemiBold" Foreground="{StaticResource TextSecondaryBrush}"/>
                    
                    <Button Grid.Column="3" Content="{loc:Tr Btn_AddPoint}" Click="AddPoint_Click" Padding="12,4" FontSize="11" Background="#3F3F5A" Foreground="{StaticResource TextPrimaryBrush}" BorderThickness="0" Cursor="Hand">
                     <Button.Resources><Style TargetType="Border"><Setter Property="CornerRadius" Value="4"/></Style></Button.Resources>
                    </Button>
                </Grid>
                
                <!-- Presets Section -->
                <Grid Margin="0,0,0,12">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/> <!-- Reload -->
                        <ColumnDefinition Width="Auto"/> <!-- Save -->
                        <ColumnDefinition Width="Auto"/> <!-- Delete -->
                        <ColumnDefinition Width="Auto"/> <!-- Folder -->
                    </Grid.ColumnDefinitions>
                    
                    <ComboBox x:Name="PresetCombo" Grid.Column="0" Width="140" IsEditable="True" DisplayMemberPath="Name" SelectionChanged="Preset_SelectionChanged"/>
                    
                    <Button Grid.Column="2" Content="â†»" Width="30" Margin="8,0,0,0" Click="ReloadPreset_Click" ToolTip="{loc:Tr Tip_ReloadPresets}"/>
                    <Button Grid.Column="3" Content="{loc:Tr Btn_SavePreset}" Margin="8,0,0,0" Click="SavePreset_Click" Padding="8,0"/>
                    <Button Grid.Column="4" Content="ðŸ—‘" Width="30" Margin="8,0,0,0" Click="DeletePreset_Click" ToolTip="{loc:Tr Tip_DeletePreset}" Background="#FF4444"/>
                    <Button Grid.Column="5" Content="{loc:Tr Btn_Folder}" Click="OpenPresetFolder_Click" Padding="8,2" FontSize="11" Background="#3F3F5A" Foreground="{StaticResource TextPrimaryBrush}" BorderThickness="0" Cursor="Hand">
                        <Button.Resources><Style TargetType="Border"><Setter Property="CornerRadius" Value="4"/></Style></Button.Resources>
                    </Button>
                </Grid>
                
                <TextBlock Text="{loc:Tr Help_Text}" 
                           FontSize="11" Foreground="{StaticResource TextSecondaryBrush}" Margin="0,0,0,8"/>
                
                <!-- Frequency Range Inputs -->
                <Grid Margin="0,0,0,8">
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Left">
                        <TextBlock Text="{loc:Tr Label_Min}" VerticalAlignment="Center" Foreground="{StaticResource TextSecondaryBrush}" Margin="0,0,4,0"/>
                        <TextBox x:Name="MinFreqInput" Text="20" Width="40" Padding="2" LostFocus="FreqRange_Changed"/>
                        <TextBlock Text="Hz" VerticalAlignment="Center" Foreground="{StaticResource TextSecondaryBrush}" Margin="2,0,0,0"/>
                    </StackPanel>
                    
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                            <TextBlock Text="{loc:Tr Label_Max}" VerticalAlignment="Center" Foreground="{StaticResource TextSecondaryBrush}" Margin="0,0,4,0"/>
                        <TextBox x:Name="MaxFreqInput" Text="20000" Width="50" Padding="2" LostFocus="FreqRange_Changed"/>
                        <TextBlock Text="Hz" VerticalAlignment="Center" Foreground="{StaticResource TextSecondaryBrush}" Margin="2,0,0,0"/>
                    </StackPanel>
                </Grid>

                <Border BorderBrush="#3F3F5A" BorderThickness="1" Background="#1E1E2E" 
                        Height="240" Margin="0,0,0,8" ClipToBounds="True">
                    <Grid>
                        <!-- Grid Lines & Labels -->
                        <Canvas x:Name="EqGridCanvas" IsHitTestVisible="False"/>
                        
                        <!-- Main Interaction Canvas -->
                        <Canvas x:Name="EqCanvas" Background="Transparent"
                                MouseLeftButtonDown="EqCanvas_MouseLeftButtonDown"
                                MouseRightButtonDown="EqCanvas_MouseRightButtonDown"
                                MouseMove="EqCanvas_MouseMove"
                                MouseLeftButtonUp="EqCanvas_MouseLeftButtonUp"
                                MouseLeave="EqCanvas_MouseLeave"
                                MouseWheel="EqCanvas_MouseWheel">
                                
                            <!-- Real-time Spectrum Analyzer -->
                            <Polygon x:Name="SpectrumPolyline" 
                                     Fill="#3300FFFF" Stroke="#8000FFFF" StrokeThickness="1"
                                     IsHitTestVisible="False"/>
                                     
                            <!-- EQ Frequency Response Curve -->
                            <Polyline x:Name="EqResponsePolyline" 
                                      Stroke="{StaticResource AccentBrush}" StrokeThickness="2"
                                      IsHitTestVisible="False"/>
                        </Canvas>
                        
                        <!-- 0dB Dashed Line -->
                        <Line x:Name="ZeroDbLine" Stroke="#555" StrokeDashArray="2 2" VerticalAlignment="Center" IsHitTestVisible="False"/>
                        <!-- Noise Gate Threshold Line -->
                        <Line x:Name="NoiseGateLine" Stroke="#D65" StrokeDashArray="3 2" StrokeThickness="1.5" IsHitTestVisible="False"/>
                    </Grid>
                </Border>
                
                <!-- Noise Gate Control -->
                <TextBlock Text="{loc:Tr Group_NoiseGate}" FontWeight="SemiBold" Foreground="{StaticResource TextSecondaryBrush}" Margin="0,8,0,4"/>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="40"/>
                    </Grid.ColumnDefinitions>
                    <Slider x:Name="NoiseGateSlider" Style="{StaticResource ModernSlider}"
                            Minimum="-80" Maximum="0" Value="-80" 
                            TickFrequency="5" IsSnapToTickEnabled="False"
                            SmallChange="1" LargeChange="10"
                            AutoToolTipPlacement="TopLeft"
                            ValueChanged="NoiseGateSlider_ValueChanged"/>
                    <TextBlock x:Name="NoiseGateValueText" Grid.Column="1" Text="-80dB" 
                               VerticalAlignment="Center" HorizontalAlignment="Right" 
                               Foreground="{StaticResource TextSecondaryBrush}"/>
                </Grid>
                <TextBlock Text="{loc:Tr Help_NoiseGate}" FontSize="10" Foreground="{StaticResource TextSecondaryBrush}" Margin="0,2,0,0"/>



                <!-- Level Meter -->
                <Grid Margin="0,12,0,0">
                    <TextBlock Text="{loc:Tr Label_OutputLevel}" FontSize="12" Foreground="{StaticResource TextSecondaryBrush}" HorizontalAlignment="Left" VerticalAlignment="Center"/>
                    <Grid Height="6" Margin="70,0,0,0" VerticalAlignment="Center">
                        <Rectangle Fill="#3F3F5A" RadiusX="3" RadiusY="3"/>
                        <Rectangle x:Name="LevelMeter" HorizontalAlignment="Left" Width="0" RadiusX="3" RadiusY="3" Fill="{StaticResource SuccessBrush}"/>
                    </Grid>
                </Grid>

            </StackPanel>
        </Border>

        <Grid Grid.Row="7" Height="20"/>
        
        <StackPanel Grid.Row="8" Orientation="Horizontal" HorizontalAlignment="Center">
            <CheckBox x:Name="StartupCheckbox" Content="{loc:Tr Check_Startup}" Foreground="{StaticResource TextSecondaryBrush}" Checked="StartupCheckbox_Changed" Unchecked="StartupCheckbox_Changed"/>
            <TextBlock x:Name="UpdateStatusText" Margin="20,0,0,0" Foreground="{StaticResource TextSecondaryBrush}" FontSize="11" VerticalAlignment="Center" Cursor="Hand" MouseLeftButtonDown="UpdateStatusText_Click"/>
        </StackPanel>
    </Grid>
</Window>
